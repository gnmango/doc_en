# UIShop
1. Create the new UIShop component. Add a component to **ui - DefaultGroup - Shop**.
![UIShop](https://mod-file.dn.nexoncdn.co.kr/bbs/16986412576855dfd79bc352a407f9341732f6bdfd735.png "UIShop")
1.  Add new **itemUI, scrollView, ShopBtnPath** and **SyncTable** properties.

    ```lua
    Property:
    [None]
    Entity itemUI = nil
    [None]
    Entity scrollView = nil
    [None]
    string ShopBtnPath = "/ui/DefaultGroup/RPGButtons/btn_shop"
    [None]
    SyncTable<string, Entity> SlotItems
    ```
2. Add a OnBeginPlay() function.

    ```lua
    [client only]
    void OnBeginPlay()
    {
        self.itemUI =_EntityService:GetEntityByPath(self.Entity.Path .. "/ShopPanel/Shop_ScrollView/item_slot")
        self.itemUI:SetEnable(false)
        self.scrollView = _EntityService:GetEntityByPath(self.Entity.Path .. "/ShopPanel/Shop_ScrollView")
        
        -- Add UI Preset/Buttons
        local inventoryButton = _EntityService:GetEntityByPath(self.ShopBtnPath)
        if inventoryButton ~= nil then
        	local openFunc = function()
        		self.Entity.Enable = true
        	end
        	if inventoryButton.ButtonComponent == nil then
        		inventoryButton:AddComponent("MOD.Core.ButtonComponent")
        	end
        	inventoryButton:ConnectEvent(ButtonClickEvent, openFunc)
        end
        
        -- Close Button
        local closeButton = _EntityService:GetEntityByPath(self.Entity.Path .. "/ShopPanel/CloseButton")
        local closeFunc = function()
        	self.Entity.Enable = false
        end
        
        closeButton:ConnectEvent(ButtonClickEvent, closeFunc)
        
    }
    ```

3. Add a InitializeItemList() function. 

    ```lua
    [client only]
    void InitializeItemList()
    {
        -- Place items in the product list in the order of the index.
        
        local itemTable = _Data.ItemTable
        local itemCount = _Data.ItemTableRowCount
        
        -- Prepare as many empty slots as items. 
        local shopItemSlots = {}
        for i = 1, itemCount do
        	shopItemSlots[i] = _SpawnService:SpawnByEntity(self.itemUI, "Item", Vector3.zero, self.scrollView) 
        end
        
        -- Place items in the slot in the order of the index.
        for k, v in pairs(itemTable) do
        	---@type ItemInfo
        	local itemInfo = v
        	shopItemSlots[itemInfo.Index].UIShopItemSlot:SetData(itemInfo.Id, itemInfo.Price)
        end
    }
    ```
    
4. Add code to the bottom of the OnBeginPlay() function to call the InitializeItemList().

    ```lua
    -- Initialize the product list.
    self:InitializeItemList()
    ```
    
# UIShopItemSlot
1. Create the UIShopItemSlot component and add it to the **ui - DefaultGroup - Shop - ShopPanel - Shop_ScrollView - Item_Slot**.
![UIShopItemSlot](https://mod-file.dn.nexoncdn.co.kr/bbs/170228214334842cb5138c86042afba807a937e704e97.png "UIShopItemSlot")
2. Add a **ItemId** property.

    ```lua
    Property:
    [None]
    string ItemId = ""
    ```

3. Create the SetData() function and add it to the **itemId** and **itemPrice** parameters. Write to make the data value visible in the UI.

    ```lua
    void SetData (string itemId, integer itemPrice)
    {
        ---@type ItemInfo
        local itemInfo = _Data.ItemTable[itemId]
        
        if itemInfo == nil then
        	log_error("[UIShopItemSlot] (SetData) Item Id Error")
        	return 
        end
        
        local imageEntity = self.Entity:GetChildByName("img_slot")
        local nameEntity = self.Entity:GetChildByName("item_name")
        local priceEntity = self.Entity:GetChildByName("item_price")
        
        imageEntity.SpriteGUIRendererComponent.ImageRUID = itemInfo.IconRUID
        nameEntity.TextComponent.Text = itemInfo.Name
        priceEntity.TextComponent.Text = tostring(itemPrice) .. " Meso"
        
        self.ItemId = itemId
    }
    ```

4. Add **ButtonClickEvent** to Event Handler. Write the following to make the Buy Pop-up UI appear when a product is selected.

    ```lua
    [self]
    HandleButtonClickEvent (ButtonClickEvent event)
    {
        -- Parameters
        local Entity = event.Entity
        --------------------------------------------------------
        
        local popup = _EntityService:GetEntityByPath("/ui/DefaultGroup/Shop/BuyPopup")
        popup.UIBuyPopup:SetData(self.ItemId)
        popup:SetEnable(true)
    }
    ```

# UIBuyPopup
Display information about the selected item in the store UI. You can enter the number of items that you want to purchase. Click the Confirm button to proceed with the purchase.
1. Create the UIBuyPopup component and add it to the BuyPopup UI entity.
![UIBuyPopup](https://mod-file.dn.nexoncdn.co.kr/bbs/1698200292074300de1b22d3640dea82d2f4d987fbd48.png{"width":"340px"} "UIBuyPopup")

1. Add a new property.
    ```lua
    Property:
    [None]
    string ItemId = ""
    ```

2. Add a OnBeginPlay function. Write it to close the UI upon pressing the Close button.
    ```lua
    [client only]
    void OnBeginPlay()
    {
        self.Entity:SetEnable(false)
        
        -- Close Button
        local closeButton = self.Entity:GetChildByName("btn_close")
        local closeFunc = function()
        	self.Entity.Enable = false
        end
        
        closeButton:ConnectEvent(ButtonClickEvent, closeFunc)
    }
    ```
3. Add a SetData() function. Add a string-type parameter **itemId**. Write to make the item information appear in the Store UI.

    ```lua
    void SetData (string itemId)
    {
        ---@type ItemInfo
        local itemInfo = _Data.ItemTable[itemId]
        
        if itemInfo == nil then
        	log_error("[UIBuyPopup] (SetData) Item Id Error: " .. itemId)
        	return
        end
        
        local imageEntity = self.Entity:GetChildByName("img_item")
        local nameEntity = self.Entity:GetChildByName("txt_name")
        local inputEntity = self.Entity:GetChildByName("input_count")
        
        imageEntity.SpriteGUIRendererComponent.ImageRUID = itemInfo.IconRUID
        nameEntity.TextComponent.Text = itemInfo.Name
        inputEntity.TextInputComponent.Text = "1"
        
        self.ItemId = itemId
    }
    ```

4. Add **ButtonClickEvent** to Event Handler. Connect the **Btn_accept** button to proceed with the purchase by pressing the Confirm button.
![butAcceptBtn](https://mod-file.dn.nexoncdn.co.kr/bbs/16981925049545f96382626bc43ca9fc2e918fbf6a6fa.png{"width":"430px"} "butAcceptBtn")
    ```lua
    Event Handler:
    [entity: btn_accept(/ui/DefaultGroup/Shop/BuyPopup/btn_accept)
    HandleButtonClickEvent (ButtonClickEvent event)
    {
        --------------- Native Event Sender Info ----------------
        -- Sender: ButtonComponent
        -- Space: Client
        ---------------------------------------------------------
        
        -- Parameters
        local Entity = event.Entity
        ---------------------------------------------------------
        
        -- Proceed with the purchase for the number of entered items.
        local inputEntity = self.Entity:GetChildByName("input_count")
        local count = tonumber(inputEntity.TextInputComponent.Text)
        _Shop:Buy(self.ItemId, count)
        self.Entity:SetEnable(false)
    }
    ```
# Modify UIInventoryItemSlot
Let's make a sale pop-up appear when the product is selected in the `UIInventoryItemSlot` component.

1. Add **ButtonClickEvent** to Event Handler. Write the following to enable the sale pop-up.

    ```lua
    [self]
    HandleButtonClickEvent (ButtonClickEvent event)
    {
        -- Only when there is an item in the slot
        if self.ItemId == "" then
            return
        end

        -- Enable the sale pop-up.
        local popup = _EntityService:GetEntityByPath("/ui/DefaultGroup/Shop/SellPopup")
        popup.UISellPopup:SetData(self.SlotIndex, self.ItemId, self.ItemCount)
        popup:SetEnable(true)
    }
    ```

# UISellPopup
Write this to enter the number of items you want to sell by pressing the items in the inventory and then pressing the Confirm button to sell them.
1. Create the UISellPopup component and add it to the SellPopup.
![UISellPopup](https://mod-file.dn.nexoncdn.co.kr/bbs/1698200337212469b767d86644664a1fbebe99f4ce845.png{"width":"340px"} "UISellPopup")
2. Add an integer-type **InventorySlotIndex** property.
    ```lua
    Property:
    [None]
    integer InventorySlotIndex = 0
    ```
3. Write the following to add the **OnBeginPlay** function and connect the Close button to the ButtonClickEvent.

    ```lua
    [client only]
    void OnBeginPlay ()
    {
        self.Entity:SetEnable(false)
        
        -- Close Button
        local closeButton = self.Entity:GetChildByName("btn_close")
        local closeFunc = function()
        	self.Entity.Enable = false
        end
        
        closeButton:ConnectEvent(ButtonClickEvent, closeFunc)
    }
    ```
    
3. Add a SetData() function. Add the **inventorySlotIndex, itemId** and **itemCount** parameters.

    ```lua
    void SetData (integer inventorySlotIndex, string itemId, integer itemCount)
    {
        ---@type ItemInfo
        local itemInfo = _Data.ItemTable[itemId]
        
        if itemInfo == nil then
        	log_error("[UISellPopup] (SetData) Item Id Error: " .. itemId)
        	return
        end
        
        local imageEntity = self.Entity:GetChildByName("img_item")
        local nameEntity = self.Entity:GetChildByName("txt_name")
        local inputEntity = self.Entity:GetChildByName("input_count")
        imageEntity.SpriteGUIRendererComponent.ImageRUID = itemInfo.IconRUID
        nameEntity.TextComponent.Text = itemInfo.Name
        inputEntity.TextInputComponent.Text = tostring(itemCount)
        
        self.InventorySlotIndex = inventorySlotIndex
    }
    ```

4. Add **ButtonClickEvent** to Event Handler. Connect the **Btn_accept** button to proceed with sales by pressing the Confirm button.
![SellAcceptBtn](https://mod-file.dn.nexoncdn.co.kr/bbs/16981942263688bea85845a3c403685ec856093dd836f.png{"width":"430px"} "SellAcceptBtn")
<br>
    ```lua
    [entity: btn_accept(/ui/DefaultGroup/Shop/SellPopup/btn_accept)
    HandleButtonClickEvent (ButtonClickEvent event)
    {
        --------------- Native Event Sender Info ----------------
        -- Sender: ButtonComponent
        -- Space: Client
        ---------------------------------------------------------
        
        -- Parameters
        local Entity = event.Entity
        ---------------------------------------------------------
        
        -- Proceed with the sale for the number of entered items.
        local inputEntity = self.Entity:GetChildByName("input_count")
        local count = tonumber(inputEntity.TextInputComponent.Text)
        _Shop:Sell(self.InventorySlotIndex, count)
        self.Entity:SetEnable(false)
    }
    ```